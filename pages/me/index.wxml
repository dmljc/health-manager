<view class="me-page">
  <view class="header">
    <view class="avatar-box">
      <image wx:if="{{userInfo && userInfo.avatarUrl}}" class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
      <view wx:else class="avatar placeholder">👤</view>
    </view>
    <view class="info">
      <text class="nick">{{userInfo && userInfo.nickName ? userInfo.nickName : '未登录'}}</text>
      <text class="wxid">微信标识（OpenID）：{{userInfo ? (maskedUserId || '同步中') : '登录后显示'}}</text>
    </view>
  </view>

  <view class="card" wx:if="{{!userInfo}}">
    <view class="card-title">完善资料</view>
    <view class="card-desc">选择头像并填写昵称，保存后用于登录与云端备份。</view>
    <view class="actions">
      <button class="secondary" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">选择头像</button>
      <input class="nick-input" type="nickname" placeholder="填写昵称" bindinput="onNicknameInput" value="{{pendingNickName}}" />
      <button class="primary" bindtap="onSubmitProfile" hover-class="tap-active">保存资料并登录</button>
    </view>
  </view>

  <view class="card" wx:if="{{userInfo}}">
    <view class="card-title">账号状态</view>
    <view class="card-desc">已登录。你可以随时退出登录，数据仍保留在云端。</view>
    <view class="actions">
      <button class="secondary" bindtap="onLogout" hover-class="tap-active">退出登录</button>
      <button class="secondary" bindtap="onLogoutAndClear" hover-class="tap-active">退出并清缓存</button>
    </view>
  </view>
</view>