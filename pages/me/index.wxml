<view class="me-page">
  <!-- 未登录时显示渐变 Hero -->
  <view class="hero" wx:if="{{!userInfo}}">
    <view class="hero-title">完善资料</view>
    <view class="wxid-line">
      <text class="wxid-text">微信标识 (OpenID)：</text>
      <view class="pill pill-gradient">登录后显示</view>
    </view>
  </view>

  <!-- 已登录时显示账户信息卡片 -->
  <view class="card account-card" wx:else>
    <view class="card-row">
      <view class="avatar-box">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
      </view>
      <view class="info">
        <view class="nick">{{userInfo.nickName}}</view>
        <view class="wxid">OpenID：{{maskedUserId || '同步中'}}</view>
      </view>
    </view>
  </view>

  <!-- 未登录时显示资料完善卡片 -->
  <view id="profile-card" class="card" wx:if="{{!userInfo}}">
    <view class="avatar-select">
      <button class="avatar-large-btn" hover-class="tap-active" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image wx:if="{{pendingAvatarUrl}}" class="avatar-large" src="{{pendingAvatarUrl}}" mode="aspectFill" />
        <view wx:else class="avatar-large placeholder">👤</view>
        <view class="avatar-plus">+</view>
      </button>
      <view class="avatar-text">
        <!-- <view class="card-title">完善资料</view> -->
        <view class="card-desc">选择头像并填写昵称，保存后用于登录与云端备份。</view>
      </view>
    </view>

    <view class="field">
      <view class="label">昵称</view>
      <input class="value" type="nickname" placeholder="填写昵称" placeholder-class="input-ph" bindinput="onNicknameInput" value="{{pendingNickName}}" />
    </view>

    <view class="save-section">
      <button class="save-btn" bindtap="onSubmitProfile" hover-class="tap-active">
        <text class="save-text">保存资料并登录</text>
      </button>
    </view>
  </view>

  <!-- 登录后仅保留一个与“保存资料并登录”样式一致的退出按钮 -->
  <view class="save-section" wx:if="{{userInfo}}">
    <button class="save-btn" bindtap="onLogout" hover-class="tap-active">
      <text class="save-text">退出登录</text>
    </button>
  </view>
</view>